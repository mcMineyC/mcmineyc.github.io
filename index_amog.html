<!DOCTYPE html>
<html lang="en">
<head>
    <title>Art Masters Online Gallery</title>
    <style>
        .header{
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            width:80%;
        }
        .footer{
            background: linear-gradient(to right, #2a7ae2, #b72ae2);
            height: 4px;
        }
        body{
            background: #222;
            color: #dfdfdf;
            font: 400 20px/1.5 "Raleway",sans-serif;
        }
        #errorcont, #errorcont > h2{
            height:auto;
            padding-top:50px;
            padding-bottom:auto;
            margin: auto;
            text-align: center;
        }
    </style>
    <script src="tohttps.js"></script>
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <link rel="stylesheet" href="js/natural-gallery-js/natural-gallery.css">
    <link rel="stylesheet" href="css/raleway.css">
    <link rel="stylesheet" href="js/natural-gallery-js/themes/natural.css">
    <script src="js/natural-gallery-js/natural-gallery.js" defer></script>
    <link rel="stylesheet" href="js/photoswipe/dist/photoswipe.css">
    <script type="module" src="js/photoswipe/dist/photoswipe.esm.min.js" defer></script>
    <script src="js/axios.js"></script>
    <!--gallery init-->
    <script>
        var count = 0
        var gallery;
        
        
        //init gallery
        window.addEventListener('load', function() {
            var options = {
                photoSwipeOptions: {
                    loop: true,
                    wheelToZoom: true,
                    closeOnVerticalDrag: true,
                    escKey: true,
                    errorMsg: 'Error loading image'
                },
                showLabels: 'always',
                lightbox: true,
                itemsPerRow: 4,
                rowHeight: 400,
                backgroundSize: 'cover',
                backgroundPosition: 'center'
            };
            // Get reference of gallery container
            var elementRef = document.getElementById('gallery');

            // Get reference of photoswipe element
            var photoswipeRef = document.getElementsByClassName('pswp')[0];

            gallery = new NaturalGallery.Natural(elementRef,options,photoswipeRef);
            var items = []
            //get data
            axios.get('https://forkleserver.mooo.com/getcount')
            .then(response => {
                count = parseInt(response.data)
                console.log("Got count: "+count)
                if(count == 0){
                    document.getElementById("errorcont").innerHTML = "<h2>No art here!<br><a href=\"/submit\">Submit some?</a></h2>"
                }
                axios.get('https://forkleserver.mooo.com/getstuff')
                .then(response => {
                    const data = response.data;
                    var datii = JSON.parse(JSON.stringify(data))
                    console.log(`GOT data`, data);
                    console.log(count)
                    for(i=1;i<count+1;i++){
                        console.log("data "+i+": "+JSON.stringify(datii[i]))
                        items[i] = (datii[i])
                    }
                    console.log("init gallery")
                    gallery.setItems(items)
                    gallery.init();
                    console.log("done?")
                }).catch(error => console.error(error));
            }).catch(error => console.error(error));
            
        })
    </script>

    <h1 class="header">Art Masters Online Gallery</h1>
    <div id="errorcont">

    </div>
    <div id="body" style="overflow:auto;min-height:95%;height:95%;width:90%;margin-right:5%;margin-left:5%;margin-top:5%;margin-bottom:5%;">
        <div id="gallery"></div>
    </div>
    
    <!--photoswipe-->
     <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>
    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
    </div>

    <footer>
        <h3><img src="img/coder.png" style="padding-right: 10px;padding-top:14px" height="26px" width="30px">Made by Jedi M. </h3><div style="width:20px"></div><a href="mailto:jedi.master@falconhosting.net?subject=Problem with Art Masters Online Gallery">Takedown, reupload, or other request</a>
    </footer>
</body>
</html>